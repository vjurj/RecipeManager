---
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";

const posts = await getCollection('blog');
---

<!doctype html>
<html lang="en">
  <BaseHead />
  <Header />

  <body>
    <div class="post-grid" id="postGrid">
      {
        posts.map((post) => (
          <a 
            href={`/RecipeManager/blog/${post.slug}/`} 
            class="post-card"
            data-title={post.data.title.toLowerCase()}
          >
            <div class="post-card-content">
              <h3 class="post-card-title">{post.data.title}</h3>
              <img src={post.data.heroImage} alt={post.data.title} />
            </div>
          </a>
        ))
      }
    </div>
    <div id="no-results" style="display:none; text-align:center; margin-top:2rem; color:var(--color-muted);"> Nu s-au gasit retete </div>

  <script>
  const searchInput = document.getElementById("search");
  const cards = document.querySelectorAll(".post-card");
  const noResults = document.getElementById("no-results");

  if (searchInput instanceof HTMLInputElement && noResults instanceof HTMLElement) {
    searchInput.addEventListener("input", (event) => {
      const target = event.target;
      if (!(target instanceof HTMLInputElement)) return;

      const query = target.value.toLowerCase();
      let visibleCount = 0;

      cards.forEach((card) => {
        if (!(card instanceof HTMLElement)) return;

        const title = card.dataset.title ?? "";

        if (title.includes(query)) {
          card.style.display = "block";
          visibleCount++;
        } else {
          card.style.display = "none";
        }
      });

      noResults.style.display = visibleCount === 0 ? "block" : "none";
    });
  }
</script>


  </body>
</html>
