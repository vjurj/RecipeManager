---
import { SITE_TITLE } from '../consts';
---

<header class="topbar">
  <nav class="topbar-inner">
    <h3><a href="/RecipeManager">{SITE_TITLE}</a></h3>

    <div class="right-side">
      <input 
        id="search"
        type="text"
        placeholder="Cauta reteta..."
        class="searchbar"
      />

      <!-- Hidden by default -->
      <button id="push-btn" class="git-btn" style="display:none;">
        Push changes
      </button>
    </div>
  </nav>
</header>

<script>
  async function checkChanges() {
    try {
      const res = await fetch("/api/hasChanges");
      const data = await res.json();

      const btn = document.getElementById("push-btn");
      btn.style.display = data.hasChanges ? "inline-block" : "none";
    } catch (err) {
      console.error("Failed to check git changes", err);
    }
  }

  // Run on load
  checkChanges();

  // Optional: re-check every 5 seconds
  setInterval(checkChanges, 5000);

  // Button action
  document.getElementById("push-btn").addEventListener("click", async () => {
    const res = await fetch("/api/push");
    const text = await res.text();
    alert(text);
    checkChanges(); // refresh visibility
  });
</script>

<style>
  .topbar {
    width: 100%;
    background: #fff;
    border-bottom: 1px solid #e5e5e5;
    padding: 0.75rem 1rem;
  }

  .topbar-inner {
    max-width: 900px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .right-side {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .searchbar {
    padding: 0.4rem 0.6rem;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 0.9rem;
    width: 180px;
  }

  .searchbar:focus {
    outline: none;
    border-color: var(--color-link);
  }

  .git-btn {
    padding: 0.4rem 0.6rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
  }

  .git-btn:hover {
    background: #005fa3;
  }
</style>